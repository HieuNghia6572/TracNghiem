<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml"
      xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" th:href="@{/css/giaodienthi.css}">
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.1/css/jquery.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.1/js/jquery.dataTables.min.js"></script>

    <style>



        body {
            padding:0px;
        }
        header {
            background-color: #0d6efd; /* Màu nền header */
            color: #fff;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); /* Đổ bóng cho header */
        }
        .section-title {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5rem;
            color: #343a40; /* Màu chữ */
        }
        .search-container {
            margin-bottom: 20px;
            display: flex;
            justify-content: center; /* Căn giữa */
            gap: 10px; /* Khoảng cách giữa các phần tử */
        }
        .custom-input, .custom-select {
            border: 2px solid #0d6efd; /* Màu viền */
            border-radius: 10px; /* Bo tròn các góc */
            padding: 10px; /* Khoảng cách bên trong */
        }
        .table {
            background-color: #fff; /* Màu nền bảng */
            border-radius: 10px; /* Bo tròn các góc của bảng */
            overflow: hidden; /* Ẩn phần viền bảng */
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1); /* Đổ bóng */
        }
        .table th {
            background-color: #0d6efd; /* Nền cho tiêu đề bảng */
            color: #fff; /* Màu chữ tiêu đề */
        }
        .text-ellipsis {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 150px;
        }
        .nav {
            list-style: none; /* Xóa dấu chấm */
            padding: 0;
            margin: 0;
        }
        .nav-item {
            margin-left: 20px; /* Khoảng cách giữa các item */
        }
        .nav-link {
            text-decoration: none; /* Xóa gạch chân */
            transition: color 0.3s; /* Hiệu ứng chuyển màu */
        }
        .nav-link:hover {
            color: #ffcc00; /* Màu khi hover */
        }
        .py-0 {
            padding-top:0px;
            padding-bottom:opx;"
        }
        @keyframes blink {
            0% {
                background-color: #ffffff; /* Màu nền ban đầu (trắng) */
            }
            50% {
                background-color: #00BFFF; /* Màu nền giữa (xanh dương nhạt) */
            }
            100% {
                background-color: #ffffff; /* Trở lại màu nền ban đầu (trắng) */
            }
        }

        header {
            animation: blink 5s infinite; /* Áp dụng animation lấp lánh */
        }

        .nav-link {
            color: #000; /* Màu chữ ban đầu */
            transition: color 0.5s ease;
        }

        header:hover .nav-link {
            color: #000080; /* Màu chữ khi hover (xanh đậm) */
        }
        .li-container {
            display: flex; /* Sử dụng Flexbox để chia thành hai phần */
            justify-content: space-between; /* Căn giữa các phần tử */
            align-items: center; /* Căn giữa theo chiều dọc */
        }

        .part1 {
            flex: 1; /* Chiếm không gian còn lại */
            /* Thêm các thuộc tính khác nếu cần */
        }

        .part2 {
            flex: 1; /* Chiếm không gian còn lại */
            /* Thêm các thuộc tính khác nếu cần */
        }
        .duongke {
            height: 4px; /* Độ dày của đường kẻ */
            background-color: #000; /* Màu đen cho đường kẻ */
            margin: 20px 0; /* Khoảng cách trên và dưới đường kẻ */
        }

    </style>
    <title>Giao diện thi</title>
</head>
<body>

<header>
    <div class="container">
        <div class="d-flex justify-content-between align-items-center py-0">
            <div class="logo d-flex align-items-center" style="white-space: nowrap;">
<!--                <img th:src="@{/img/logo_khongnen.png}" alt="" height="100" width="180">-->
                <img th:src="@{/test/gif_logo.gif}" alt="GIF" height="110" width="180" style="max-width: 100%; height: auto; border-radius: 15px;">
                <p class="text-black mb-0 link-hover" style="color:black; margin-left: 50px;"> <!-- Thêm margin-left 50px -->
                    <strong>
                        Xin chào: <span sec:authentication="name"></span>
                        đến với bài thi <span th:text="${'môn ' + thongtinde.monthi.tenmonthi}"></span>
                        với <span th:text="${'mã đề ' + thongtinde.madethi}"></span>
                    </strong>
                </p>
                <div class="ml-3" style="color:black; margin-left: 100px !important ;font-weight: bold;">
                    <p class="mb-0">| Thời gian hiện tại: <span id="time"></span> |</p>
                    <p>Thời gian thi: <span id="countdown"></span></p>
                </div>


            </div>


        </div>
    </div>
</header>

<div class="content" id="content">
    <div class="row">
        <div class="col-2" style="background-color: #f8f9fa;">

        </div>
        <div class="col-8">
            <h1 style="text-align: center" th:text="${'Mã đề: '+thongtinde.madethi}"></h1>
            <h1 style="text-align: center" th:text="${'Tên môn thi: '+thongtinde.monthi.tenmonthi}"></h1>
            <form id="quiz-form" method="post" action="/submitQuiz">
                <input type="hidden" name="deThiId" th:value="${thongtinde.id}"/>
                <input type="hidden" id="userId" th:value="${userId}" />
                <!-- Gán giá trị cho deThiId -->
                <ul class="quiz">
                    <li th:each="baithi, stat : ${chiTietDeThiList}" class="li-container">
            <span class="part1">
                <div class="questionz-container">
                    <div class="duongke"></div>
                    <h4 th:utext="${'Câu hỏi ' + (stat.index + 1) + ': ' + (baithi.cauHoi.ten != null ? baithi.cauHoi.ten : '')}"></h4>
                </div>

                <span class="image-part" th:if="${baithi.cauHoi != null and baithi.cauHoi.ImgUrl != null and baithi.cauHoi.ImgUrl != ''}" style="margin-left: 100px !important">
                    <img th:src="${baithi.cauHoi.ImgUrl}" alt="Hình ảnh câu hỏi" height="110" width="110" />
                </span>

                <ul class="choices" style="margin-left: 50px !important">
                    <li>
                        <label class="choice-label">
                            <input type="radio" th:name="${'question_' + baithi.id}" th:value="'A'" th:checked="${baithi.dapanchon == 'A'}" />
                            <span th:text="${'A.  ' + (baithi.cauHoi.dapanA != null ? baithi.cauHoi.dapanA : '')}"></span>
                        </label>
                    </li>
                    <li>
                        <label class="choice-label">
                            <input type="radio" th:name="${'question_' + baithi.id}" th:value="'B'" th:checked="${baithi.dapanchon == 'B'}" />
                            <span th:text="${'B.  ' + (baithi.cauHoi.dapanB != null ? baithi.cauHoi.dapanB : '')}"></span>
                        </label>
                    </li>
                    <li>
                        <label class="choice-label">
                            <input type="radio" th:name="${'question_' + baithi.id}" th:value="'C'" th:checked="${baithi.dapanchon == 'C'}" />
                            <span th:text="${'C.  ' + (baithi.cauHoi.dapanC != null ? baithi.cauHoi.dapanC : '')}"></span>
                        </label>
                    </li>
                    <li>
                        <label class="choice-label">
                            <input type="radio" th:name="${'question_' + baithi.id}" th:value="'D'" th:checked="${baithi.dapanchon == 'D'}" />
                            <span th:text="${'D.  ' + (baithi.cauHoi.dapanD != null ? baithi.cauHoi.dapanD : '')}"></span>
                        </label>
                    </li>
                </ul>
            </span>
                    </li>
                </ul>
                <button type="submit" class="save-progress">Lưu tiến trình</button>
            </form>
            <button type="button" class="view-results" onclick="viewKetQuaThi()">Nộp Bài</button>
        </div>
        <div class="col-2"style="background-color: #f8f9fa;">

        </div>
    </div>
</div>

<footer class="bg-primary text-white text-center py-4 mt-5" style="margin:0px !important;">
    <div class="container d-flex justify-content-between text-footer">
        <div class="footer-left">
            <h5 class="mb-0">Trắc nghiệm NTT</h5>
            <p class="mb-0">© 2024 Tất cả quyền được bảo lưu.</p>
        </div>
        <div class="footer-content">
            <h5 class="mb-0">Thông tin liên hệ</h5>
            <p class="mb-0">Liên hệ: phanhieunghia1054@gmail.com</p>
        </div>
    </div>
</footer>
<script>
    function fetchTime() {
        fetch('/time')
            .then(response => response.text())
            .then(data => {
                document.getElementById('time').innerText = data;
            });
    }

    // Gọi hàm fetchTime để cập nhật thời gian ngay khi tải trang
    fetchTime();
    setInterval(fetchTime, 1000); // Cập nhật mỗi giây
</script>
<script src="js/scripts.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
    function saveProgress() {
    var formData = {};
    $('#quiz-form input[type="radio"]:checked').each(function() {
        var questionId = $(this).attr('name').split('_')[1]; // Lấy ID câu hỏi
        var selectedValue = $(this).val(); // Giá trị đã chọn
        formData['question_' + questionId] = selectedValue; // Lưu vào formData
    });

    // Gửi dữ liệu đến server
    $.ajax({
        url: '/submitQuiz', // Địa chỉ endpoint để lưu dữ liệu
        type: 'POST',
        data: {
            deThiId: $('input[name="deThiId"]').val(), // Gửi deThiId
            ...formData // Gửi tất cả các câu trả lời
        },
        success: function(response) {
            alert('Lưu tiến trình thành công!');
        },
        error: function(xhr, status, error) {
            alert('Có lỗi xảy ra: ' + error);
        }
    });
}
</script>
<script>
    function viewKetQuaThi() {
       var userId = document.getElementById('userId').value; // Lấy giá trị userId
       var deThiId = $('input[name="deThiId"]').val(); // Lấy giá trị deThiId
       window.location.href = "/ketquathi/" + userId + "/" + deThiId;
   }
</script>
<script>
    let remainingTime;

    // Hàm này sẽ được gọi khi trang được tải
    window.onload = function () {
        startCountdown();
    };

    function startCountdown() {
        let countdownElement = document.getElementById("countdown");
        let interval = setInterval(function () {
            fetch('/time-remaining') // Gửi yêu cầu đến backend để lấy thời gian còn lại
                .then(response => response.json())
                .then(data => {
                    remainingTime = data.remainingTime;
                    countdownElement.innerHTML = formatTime(remainingTime);

                    // Kiểm tra nếu hết giờ
                    if (remainingTime <= 0) {
                        clearInterval(interval);
                        alert("Hết giờ!");
                    }
                })
                .catch(error => console.error('Error:', error));
        }, 1000); // Gọi mỗi giây
    }

    function formatTime(seconds) {
        let minutes = Math.floor(seconds / 60);
        let secs = seconds % 60;
        return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }
</script>
<!--toi day-->
</body>
</html>